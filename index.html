<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>未成年返金申請フォーム | refund.example.com</title>
  <!-- 法対応メモ（実装者向け）
    - 個人情報保護法: 収集目的/保管期間/第三者提供を本文で明示。入力は最小限。
    - 消費者契約法: 簡潔UI（2分以内完了想定）。
    - 刑法246条: 抑止のため注意喚起を冒頭に明示、過度に脅迫的な表現は避ける。
    - 資金決済法: キャリア決済の検証用に「対象ドメイン」「キャリア」「対象の決済番号」を必須化。
  -->
  <style>
    /* 消費者契約法: 2分以内で完了できる簡素UI。個人情報保護法: 必要最小限項目＋明示。 */

    :root {
      --bg:#fff; --fg:#111; --muted:#6b7280; --border:#e5e7eb; --warn:#ff0000; --primary:#007bff; --focus:#2563eb;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg)}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;font-size:14px;line-height:1.6}

    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}

    .container{max-width:720px;margin:0 auto;padding:16px}
    .card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:16px;margin:12px 0;box-shadow:0 1px 2px rgba(0,0,0,.03)}
    .notice{margin-bottom:8px}
    .warn{color:var(--warn);font-size:16px}

    .field{display:block;margin:12px 0}
    .field>span{display:inline-block;margin-bottom:6px;font-weight:600}
    .req{background:#fee2e2;color:#991b1b;font-size:12px;border-radius:4px;padding:2px 6px;margin-left:6px}

    input[type="text"],input[type="email"],input[type="tel"],select{
      width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:8px;font-size:14px
    }
    input:focus,select:focus{outline:none;border-color:var(--focus);box-shadow:0 0 0 3px rgba(37,99,235,.15)}

    .hint{color:var(--muted);font-size:12px;display:block;margin-top:4px}
    .error{color:#b91c1c;font-size:12px;min-height:16px;display:block;margin-top:4px}

    .option{display:block;margin:6px 0}
    .option input{margin-right:6px}

    .tabs{display:flex;gap:8px;margin-bottom:8px}
    .tab{padding:8px 12px;border:1px solid var(--border);background:#f9fafb;border-radius:20px;cursor:pointer}
    .tab.active{border-color:var(--primary);background:#eef6ff}
    .tabpane{padding:8px 0}
    .tabpane[hidden]{display:none}
    .tabpane.active{display:block}

    .subfield{display:block;margin:8px 0}
    .subfield span{display:inline-block;margin-bottom:6px}

    .agree{display:flex;align-items:flex-start;gap:8px;margin-top:12px}
    .agree input{margin-top:3px}

    .actions{display:flex;align-items:center;gap:12px;margin-top:12px}
    button[type="submit"]{background:var(--primary);color:#fff;border:none;border-radius:8px;padding:10px 16px;font-size:14px;cursor:pointer;transition:transform .02s ease}
    button[disabled]{opacity:.5;cursor:not-allowed}
    button:active{transform:translateY(1px)}
    .submit-note{font-size:12px;color:var(--muted)}

    .privacy{color:#4b5563;font-size:12px;line-height:1.7}
    .footer{text-align:center;color:var(--muted);font-size:12px;padding:16px 0 8px}

    @media (min-width:768px){.actions{justify-content:flex-start}}
  </style>
</head>
<body>
  <main class="container" role="main" aria-labelledby="page-title">
    <h1 id="page-title" class="sr-only">未成年返金申請フォーム</h1>

    <section class="card">
      <div class="notice" role="note" aria-live="polite">
        <strong class="warn">
          虚偽の未成年返金請求は詐欺罪（刑法246条）に該当する可能性があります。提出情報は厳正に確認し、虚偽が発覚した場合、法的措置（損害賠償請求、警察への相談）を講じる可能性があります。
        </strong>
      </div>

      <form id="refundForm" novalidate>
        <!-- 対象ドメイン（必須） -->
        <label class="field">
          <span>対象ドメイン <span class="req">必須</span></span>
          <input
            type="text"
            name="targetDomain"
            id="targetDomain"
            required
            placeholder="例: example.com"
            inputmode="url"
            autocomplete="off"
            value="example.com"
          />
          <small class="hint">URLを貼っても可（自動でドメイン抽出）。サブドメイン可（例: sub.example.com）。</small>
          <small class="error" id="err-targetDomain" aria-live="polite"></small>
        </label>

        <!-- サービス名（テキスト、必須） -->
        <label class="field">
          <span>サービス名 <span class="req">必須</span></span>
          <input type="text" name="serviceName" id="serviceName" required maxlength="100" placeholder="例: Story Land（電子書籍）" />
          <small class="error" id="err-serviceName" aria-live="polite"></small>
        </label>

        <!-- キャリア（必須） -->
        <label class="field">
          <span>キャリア <span class="req">必須</span></span>
          <select name="carrier" id="carrier" required>
            <option value="">選択してください</option>
            <option value="docomo">docomo（ahamo）</option>
            <option value="au">au（povo、UQ mobile）</option>
            <option value="softbank">SoftBank（LINEMO）</option>
          </select>
          <small class="error" id="err-carrier" aria-live="polite"></small>
        </label>

        <!-- 対象の決済番号（必須：キャリアに応じてラベル動的表示） -->
        <label class="field">
          <span id="paymentIdLabel">対象の決済番号 <span class="req">必須</span></span>
          <input type="text" name="paymentId" id="paymentId" required placeholder="例: xxxx-xxxx-xxxx" autocomplete="off" />
          <small class="hint">
            ※ 不明な場合は確認方法の案内（<a href="https://334.jp" target="_blank" rel="noopener">334.jp</a>）をご覧ください。
          </small>
          <small class="error" id="err-paymentId" aria-live="polite"></small>
        </label>

        <!-- 返金理由（未成年による契約のみ） -->
        <fieldset class="field">
          <legend>返金理由 <span class="req">必須</span></legend>
          <label class="option"><input type="radio" name="reason" value="未成年による契約" required checked /> 未成年による契約</label>
          <small class="error" id="err-reason" aria-live="polite"></small>
        </fieldset>

        <!-- 生年月日（18歳未満のみ有効） -->
        <label class="field">
          <span>生年月日（YYYY/MM/DD） <span class="req">必須</span></span>
          <input type="text" name="dob" id="dob" inputmode="numeric" placeholder="例: 2008/03/05" required />
          <small class="hint">18歳未満のみ申請可能（当日基準）。未来日・不正な過去年（例: 1900年）は不可。</small>
          <small class="error" id="err-dob" aria-live="polite"></small>
        </label>

        <!-- 親権者/保護者 氏名 -->
        <label class="field">
          <span>親権者/保護者の氏名 <span class="req">必須</span></span>
          <input type="text" name="guardianName" id="guardianName" maxlength="50" required placeholder="例: 山田 太郎" />
          <small class="error" id="err-guardianName" aria-live="polite"></small>
        </label>

        <!-- 連絡先（メール or 電話） -->
        <fieldset class="field">
          <legend>親権者/保護者の連絡先 <span class="req">必須</span></legend>
          <div class="tabs" role="tablist" aria-label="連絡方法">
            <button type="button" class="tab active" data-target="#emailPane" role="tab" aria-selected="true">メール</button>
            <button type="button" class="tab" data-target="#phonePane" role="tab" aria-selected="false">電話</button>
          </div>

          <div id="emailPane" class="tabpane active" role="tabpanel">
            <label class="subfield">
              <span>メールアドレス（例: example@domain.com）</span>
              <input type="email" name="guardianEmail" id="guardianEmail" placeholder="例: parent@example.com" />
              <small class="error" id="err-guardianEmail" aria-live="polite"></small>
            </label>
            <!-- 例: https://refund.example.com/verify?code=XXXX -->
          </div>

          <div id="phonePane" class="tabpane" role="tabpanel" hidden>
            <label class="subfield">
              <span>電話番号（+81-123-456-7890 形式）</span>
              <input type="tel" name="guardianPhone" id="guardianPhone" placeholder="+81-90-1234-5678" />
              <small class="error" id="err-guardianPhone" aria-live="polite"></small>
            </label>
            <!-- 将来拡張: SMSコード入力欄 -->
          </div>

          <small class="hint">※ メールか電話のいずれか一方は必須。</small>
        </fieldset>

        <!-- 同意チェック -->
        <label class="agree">
          <input type="checkbox" id="consent" required />
          <span>私は提出情報の正確性を保証し、虚偽申告が発覚した場合の責任（法的措置を含む）を了承します。</span>
        </label>
        <small class="error" id="err-consent" aria-live="polite"></small>

        <!-- 送信 -->
        <div class="actions">
          <button id="submitBtn" type="submit" disabled>申請を送信</button>
          <div id="submitNote" class="submit-note" aria-live="polite"></div>
        </div>
      </form>
    </section>

    <section class="card">
      <p class="privacy">
        収集目的：返金申請の処理および不正防止<br>
        収集情報：生年月日、親権者氏名・連絡先、対象ドメイン、キャリア、対象の決済番号、サービス名<br>
        保管期間：申請処理後3ヶ月で削除<br>
        第三者提供：キャリア決済事業者に年齢確認のため提供する場合あり<br>
        お問い合わせ：support@refund.example.com
      </p>
    </section>

    <footer class="footer">
      <small>&copy; 2025 refund.example.com</small>
    </footer>
  </main>

  <script>
    /* 法と設計のメモ
     - 個人情報保護法: クライアント側のみで処理（GitHub Pages）。サーバ保存なしデモ。
     - 消費者契約法: 入力5項目、2分以内完了想定。
     - 刑法246条: 抑止文言を表示。
     - 資金決済法: 「対象ドメイン」「キャリア」「対象の決済番号」を必須化。
    */

    const $ = (s) => document.querySelector(s);

    /** タブ切替（メール/電話） */
    (function setupTabs(){
      const tabs = document.querySelectorAll(".tab");
      tabs.forEach(tab=>{
        tab.addEventListener("click",()=>{
          tabs.forEach(t=>t.classList.remove("active"));
          tab.classList.add("active");
          const targetSel = tab.getAttribute("data-target");
          document.querySelectorAll(".tabpane").forEach(p=>{
            if("#"+p.id===targetSel){ p.hidden=false; p.classList.add("active"); }
            else { p.hidden=true; p.classList.remove("active"); }
          });
        });
      });
    })();

    /** 同意ゲート */
    (function consentGate(){
      const consent=$("#consent"), btn=$("#submitBtn");
      if(!consent||!btn) return;
      const update=()=>btn.disabled=!consent.checked;
      consent.addEventListener("change",update); update();
    })();

    /** キャリア選択に応じてラベルを動的変更（更新版） */
    (function carrierDynamicLabel(){
      const carrier=$("#carrier"), label=$("#paymentIdLabel");
      const update=()=>{
        const v=carrier.value;
        // docomo → 決済番号
        // au → 継続課金ID
        // softbank → 注文番号
        if(v==="docomo"){
          label.innerHTML='対象の決済番号（<b>docomo・ahamo: 決済番号</b>） <span class="req">必須</span>';
        }else if(v==="au"){
          label.innerHTML='対象の決済番号（<b>au・povo・UQ mobile: 継続課金ID</b>） <span class="req">必須</span>';
        }else if(v==="softbank"){
          label.innerHTML='対象の決済番号（<b>SoftBank・LINEMO: 注文番号</b>） <span class="req">必須</span>';
        }else{
          label.innerHTML='対象の決済番号 <span class="req">必須</span>';
        }
      };
      if(carrier){ carrier.addEventListener("change",update); update(); }
    })();

    /** 入力検証 */
    function validateForm(){
      [
        "#err-targetDomain","#err-serviceName","#err-carrier","#err-paymentId",
        "#err-reason","#err-dob","#err-guardianName",
        "#err-guardianEmail","#err-guardianPhone","#err-consent"
      ].forEach(sel=>{ const el=$(sel); if(el) el.textContent=""; });

      const targetDomain=$("#targetDomain").value.trim();
      const serviceName=$("#serviceName").value.trim();
      const carrier=$("#carrier").value.trim();
      const paymentId=$("#paymentId").value.trim();
      const reason=(document.querySelector('input[name="reason"]:checked')||{}).value;
      const dob=$("#dob").value.trim();
      const guardianName=$("#guardianName").value.trim();
      const guardianEmail=$("#guardianEmail").value.trim();
      const guardianPhone=$("#guardianPhone").value.trim();
      const consent=$("#consent").checked;

      let ok=true;

      // 対象ドメイン
      const extracted = extractHostname(targetDomain);
      if(!extracted){ ok=false; $("#err-targetDomain").textContent="対象ドメインを正しく入力してください（例: example.com）。"; }
      else if(!isValidDomain(extracted)){ ok=false; $("#err-targetDomain").textContent="ドメイン形式が正しくありません。"; }

      // サービス名
      if(!serviceName){ ok=false; $("#err-serviceName").textContent="サービス名を入力してください。"; }
      else if(serviceName.length>100){ ok=false; $("#err-serviceName").textContent="100文字以内で入力してください。"; }

      // キャリア
      if(!carrier){ ok=false; $("#err-carrier").textContent="キャリアを選択してください。"; }

      // 決済番号（緩め）
      if(!paymentId){ ok=false; $("#err-paymentId").textContent="対象の決済番号を入力してください。"; }
      else if(!/^[A-Za-z0-9\-_]+(?:[A-Za-z0-9\-_]+|[A-Za-z0-9\-_]+(?:-[A-Za-z0-9\-_]+)*)$/.test(paymentId)){
        ok=false; $("#err-paymentId").textContent="英数字・ハイフン・アンダースコアを用いて入力してください。";
      }

      // 返金理由（自動的に「未成年による契約」が選択されている）
      if(!reason){ ok=false; $("#err-reason").textContent="返金理由を選択してください。"; }

      // 生年月日
      const dobResult = validateDOB(dob);
      if(!dobResult.valid){ ok=false; $("#err-dob").textContent=dobResult.message; }
      else if(!dobResult.isMinor){ ok=false; $("#err-dob").textContent="未成年者に該当しません。"; }

      // 親権者氏名
      if(!guardianName){ ok=false; $("#err-guardianName").textContent="親権者/保護者の氏名を入力してください。"; }

      // 連絡先（メール or 電話）
      const emailOk = guardianEmail ? validateEmail(guardianEmail) : false;
      const phoneOk = guardianPhone ? validateJPPhone(guardianPhone) : false;
      if(!guardianEmail && !guardianPhone){
        ok=false;
        $("#err-guardianEmail").textContent="メールまたは電話のいずれかを入力してください。";
        $("#err-guardianPhone").textContent="メールまたは電話のいずれかを入力してください。";
      }else{
        if(guardianEmail && !emailOk){ ok=false; $("#err-guardianEmail").textContent="メール形式が正しくありません。"; }
        if(guardianPhone && !phoneOk){ ok=false; $("#err-guardianPhone").textContent="電話番号は +81-123-456-7890 形式で入力してください。"; }
      }

      // 同意
      if(!consent){ ok=false; $("#err-consent").textContent="同意が必要です。"; }

      return ok;
    }

    /** ドメイン抽出・検証 */
    function extractHostname(input){
      if(!input) return "";
      let s = input.trim();
      try{
        if(/^https?:\/\//i.test(s)){ const u=new URL(s); return u.hostname; }
        s = s.replace(/^[a-z]+:\/\//i,"").split("/")[0];
        return s;
      }catch{ return ""; }
    }
    function isValidDomain(host){
      const re=/^(?=.{1,253}$)(?:[A-Za-z0-9](?:[A-Za-z0-9\-]{0,61}[A-Za-z0-9])\.)+[A-Za-z]{2,}$/;
      return re.test(host);
    }

    /** DOB 検証 */
    function validateDOB(s){
      if(!/^\d{4}\/\d{2}\/\d{2}$/.test(s)){
        return {valid:false,message:"生年月日は YYYY/MM/DD 形式で入力してください。",isMinor:false};
      }
      const [y,m,d]=s.split("/").map(Number);
      if(y<1901||m<1||m>12||d<1||d>31){
        return {valid:false,message:"生年月日を正しく入力してください。",isMinor:false};
      }
      const dt=new Date(y,m-1,d);
      if(dt.getFullYear()!==y||dt.getMonth()!==m-1||dt.getDate()!==d){
        return {valid:false,message:"生年月日を正しく入力してください。",isMinor:false};
      }
      const today=new Date();
      if(dt>today) return {valid:false,message:"未来の日付は指定できません。",isMinor:false};
      const threshold=new Date(today.getFullYear()-18,today.getMonth(),today.getDate());
      const isMinor = dt>threshold;
      return {valid:true,message:"",isMinor};
    }

    /** Email / Phone */
    function validateEmail(s){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s); }
    function validateJPPhone(s){ return /^\+81-\d{1,4}-\d{1,4}-\d{3,4}$/.test(s); }

    /** 簡易不正検知（1時間に3回以上で警告） */
    function checkAbuseAndRecord(){
      const KEY="refund_submissions", now=Date.now(), H=3600000;
      let arr=[]; try{ arr=JSON.parse(sessionStorage.getItem(KEY)||"[]"); }catch{ arr=[]; }
      arr=arr.filter(ts=>now-ts<H); arr.push(now);
      sessionStorage.setItem(KEY,JSON.stringify(arr));
      if(arr.length>=3){ alert("短時間に複数の申請が確認されました。不正な申請は処理の対象外となる場合があります。"); }
    }

    /** 送信（mailto デフォルト。Google Formsはコメント参照） */
    async function submitForm(e){
      e.preventDefault();
      if(!validateForm()) return;

      $("#submitNote").textContent="送信処理中…";
      checkAbuseAndRecord();

      const data=collectFormData();

      const recipient="support@refund.example.com";
      const subject=encodeURIComponent(`【返金申請】${data.serviceName} / ${data.carrier} / ${data.paymentId}`);
      const body=encodeURIComponent([
        "以下の内容で返金申請がありました：",
        `日時: ${new Date().toLocaleString()}`,
        `対象ドメイン: ${data.targetDomain}`,
        `サービス名: ${data.serviceName}`,
        `キャリア: ${data.carrier}`,
        `対象の決済番号: ${data.paymentId}`,
        `返金理由: ${data.reason}`,
        `生年月日: ${data.dob}`,
        `親権者氏名: ${data.guardianName}`,
        `親権者連絡先: ${data.guardianEmail || data.guardianPhone}`,
        "",
        `UA: ${navigator.userAgent}`,
        `ページ: ${location.href}`
      ].join("\n"));
      const mailtoURL=`mailto:${recipient}?subject=${subject}&body=${body}`;
      window.location.href=mailtoURL;

      $("#submitNote").textContent="申請を受け付けました。通常3〜5営業日以内に結果を通知します。";
      $("#refundForm").reset();
      $("#submitBtn").disabled=true;
    }

    /** 値の収集（対象ドメインは抽出済みのホスト名に正規化） */
    function collectFormData(){
      const reasonEl = document.querySelector('input[name="reason"]:checked');
      return {
        targetDomain: extractHostname($("#targetDomain").value.trim()),
        serviceName: $("#serviceName").value.trim(),
        carrier: $("#carrier").value.trim(),
        paymentId: $("#paymentId").value.trim(),
        reason: reasonEl ? reasonEl.value : "",
        dob: $("#dob").value.trim(),
        guardianName: $("#guardianName").value.trim(),
        guardianEmail: $("#guardianEmail").value.trim(),
        guardianPhone: $("#guardianPhone").value.trim(),
      };
    }

    /** 入力補助 */
    $("#dob").addEventListener("blur",()=>{
      const r=validateDOB($("#dob").value.trim());
      $("#err-dob").textContent=r.valid?"":r.message;
    });

    /** 送信 */
    $("#refundForm").addEventListener("submit",submitForm);
  </script>
</body>
</html>